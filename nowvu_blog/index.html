<!DOCTYPE html>
<!-- saved from url=(0020)http:/// -->
<html dir="ltr" lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<title>Welcome to the Nowvu Blog. | Social media in a truly social setting…</title>
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="stylesheet" type="text/css" media="all" href="style.css">
<link rel="pingback" href="http:///xmlrpc.php">
<link rel="alternate" type="application/rss+xml" title="Welcome to the Nowvu Blog. » Feed" href="http:///feed/">
<link rel="alternate" type="application/rss+xml" title="Welcome to the Nowvu Blog. » Comments Feed" href="http:///comments/feed/">
<script type="text/javascript" async="" src="ga.js"></script><script type="text/javascript" src="jquery.js"></script><style type="text/css"></style>
<script type="text/javascript" src="external-tracking.min.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http:///xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http:///wp-includes/wlwmanifest.xml"> 
<link rel="index" title="Welcome to the Nowvu Blog." href="blog.html">
<meta name="generator" content="WordPress 3.0.1">
	<link type="text/css" rel="stylesheet" href="shCore.css">
	<link type="text/css" rel="stylesheet" href="shThemeDefault.css">
<!-- Google Analytics Tracking by Google Analyticator 6.1.1: http://ronaldheft.com/code/analyticator/ -->
<script type="text/javascript">
	var analyticsFileTypes = [''];
	var analyticsEventTracking = 'enabled';
</script>
<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-249017-8']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
</head>

<body class="home blog logged-in">
<div id="wrapper" class="hfeed">
	<div id="header">
		<div id="masthead">			
		<div id="access" role="navigation">
			  				<div class="skip-link screen-reader-text"><a href="http:///#content" title="Skip to content">Skip to content</a></div>
								<div class="menu"><ul><li class="current_page_item"><a href="blog.html" title="Home">Home</a></li><li class="page_item page-item-2"><a href="http:///about/" title="About">About</a></li></ul></div>
			</div><!-- #access -->
			<div id="branding" role="banner">
						<img src="logo.jpg" alt="" name="" width="1000" height="250" border="0" id="nowvu" style="padding: 0px 0 0 0px;">			<div id="site-info">		
			</div><!-- #branding -->



		</div><!-- #masthead -->
	</div><!-- #header -->

	<div id="main">

		<div id="container">
			<div id="content" role="main">

			




			
    <div class="entry-meta">
							<h3 class="wrap"><span class="day">31st                            </span>
                            </h3><span class="month">Aug                            <span class="year">2010</span></span>
					<h4 class="author"><a href="http:///author/andrew/" title="Posts by andrew">andrew</a></h4>
					<h4 class="comments"><a href="http:///2010/08/31/app-screenshots/#comments">0</a></h4>
			</div><!-- .entry-meta -->
            
		<div id="post-71" class="post-71 post type-post hentry category-uncategorized">
			<h2 class="entry-title"><a href="http:///2010/08/31/app-screenshots/" title="Permalink to App Screenshots" rel="bookmark">App Screenshots</a></h2>



				<div class="entry-content">
				<p>Here’s an update on what we’ve been hard at work on.  A select few of the Apps that we have been developing, now imagine these in full HD on a 42″!</p>
<h2>Youtube with our alert popup</h2>
<p><a href="youtube.png"><img src="youtube.png" alt="" title="youtube" width="600" height="337" class="alignnone size-full wp-image-72"></a></p>
<h2>Ironman 2 on Youtube</h2>
<p><a href="youtube1.png"><img src="youtube1.png" alt="" title="youtube1" width="600" height="337" class="alignnone size-full wp-image-73"></a></p>
<h2>Twitter</h2>
<p><a href="twitter.png"><img src="twitter.png" alt="" title="twitter" width="600" height="338" class="alignnone size-full wp-image-75"></a></p>
<h2>Local Weather</h2>
<p><a href="weather.png"><img src="weather.png" alt="" title="weather" width="600" height="337" class="alignnone size-full wp-image-76"></a></p>
<h2>Flickr</h2>
<p><a href="flickr.png"><img src="flickr.png" alt="" title="flickr" width="600" height="337" class="alignnone size-full wp-image-74"></a></p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
									<span class="cat-links">
						<span class="entry-utility-prep entry-utility-prep-cat-links">Posted in</span> <a href="http:///category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>					</span>
					<span class="meta-sep">|</span>
												<span class="comments-link"><a href="http:///2010/08/31/app-screenshots/#respond" title="Comment on App Screenshots">Leave a comment</a></span>
				<span class="meta-sep">|</span> <span class="edit-link"><a class="post-edit-link" href="http:///wp-admin/post.php?post=71&action=edit" title="Edit Post">Edit</a></span>			</div><!-- .entry-utility -->
		</div><!-- #post-## -->

		
	


			
    <div class="entry-meta">
							<h3 class="wrap"><span class="day">31st                            </span>
                            </h3><span class="month">Aug                            <span class="year">2010</span></span>
					<h4 class="author"><a href="http:///author/andrew/" title="Posts by andrew">andrew</a></h4>
					<h4 class="comments"><a href="http:///2010/08/31/safe-process-forking-in-php/#comments">0</a></h4>
			</div><!-- .entry-meta -->
            
		<div id="post-64" class="post-64 post type-post hentry category-uncategorized">
			<h2 class="entry-title"><a href="http:///2010/08/31/safe-process-forking-in-php/" title="Permalink to Safe process forking in PHP" rel="bookmark">Safe process forking in PHP</a></h2>



				<div class="entry-content">
				<p>Our content aggregation system in it’s simplest form consists of a list of items which each describe a method of gathering information.  For the sake of simplicity lets assume each item has a unique function which is called:</p>
<div class="syntaxhighlighter " id="highlighter_668438" style=""><div class="bar"><div class="toolbar"><a href="http:///#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http:///#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http:///#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">1.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">Austin Chronicle: getAChron()</code></span></span></div><div class="line alt2"><code class="number">2.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">Twitter: getTwitter()</code></span></span></div><div class="line alt1"><code class="number">3.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">Foursquare: getFoursquare()</code></span></span></div><div class="line alt2"><code class="number">4.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">and</code> <code class="plain">so on...</code></span></span></div></div></div>
<p>We then have a cronjob that runs a very simple PHP script on an interval which goes through and processes each function:</p>
<div class="syntaxhighlighter " id="highlighter_798692" style=""><div class="bar"><div class="toolbar"><a href="http:///#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http:///#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http:///#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">1.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">foreach</code><code class="plain">(</code><code class="variable">$contentArr</code> <code class="keyword">as</code> <code class="variable">$key</code> <code class="plain">=&gt; </code><code class="variable">$val</code><code class="plain">) {</code></span></span></div><div class="line alt2"><code class="number">2.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">call_user_func(</code><code class="variable">$val</code><code class="plain">);</code></span></span></div><div class="line alt1"><code class="number">3.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div></div></div>
<p>There are a few problems with this setup.  First and foremost has to do with php.ini’s max_execution_time.  From php.net:</p>
<blockquote><p>
This sets the maximum time in seconds a script is allowed to run before it is terminated by the parser. This helps prevent poorly written scripts from tying up the server. The default setting is 30. When running PHP from the command line the default setting is 0.</p>
<p>The maximum execution time is not affected by system calls, stream operations etc. Please see the set_time_limit() function for more details.</p>
<p>You can not change this setting with ini_set() when running in safe mode. The only workaround is to turn off safe mode or by changing the time limit in the php.ini.</p>
<p>Your web server can have other timeout configurations that may also interrupt PHP execution. Apache has a Timeout directive and IIS has a CGI timeout function. Both default to 300 seconds. See your web server documentation for specific details.
</p></blockquote>
<h2>Running in a Browser</h2>
<p>So when we run the script in a browser, we have (assuming default settings), 30 seconds to go out and get all of the data.  It’s obvious that once you have more then 10-15 processes you are going to reach the end of that limit.  Now you could up that limit or set it to 0 (unlimited) but then you will run into the same problem you get when running it from the command line (default max_execution_time=0).</p>
<h2>Running on the Command Line or in Cron</h2>
<p>As we are running it with a cron job, i.e. on the command line with an unlimited max_execution_time we have literally told the script that it can run forever.  Literally for ever, meaning hours and hours.  Under the setup we have, it’s going to run in series, meaning each process is going to wait for the previous to finish before it starts.  This is a huge problem in that one hung process can stop every following process from happening.</p>
<p>Another issue that could arise with this method is that one fatal error from a function will also kill all of the following processes, very bad.</p>
<h2>Forking with pcntl_fork()</h2>
<p>The solution is forking the processes, running them in parallel so that each may have time to finish and so that each cannot affect the outcome of another:</p>
<p>Using the same pseudo-code from before we can use pcntl_fork() to easily accomplish this:</p>
<div class="syntaxhighlighter " id="highlighter_695715" style=""><div class="bar"><div class="toolbar"><a href="http:///#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http:///#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http:///#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">01.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// create a new array to contain each processes PID</code></span></span></div><div class="line alt2"><code class="number">02.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="variable">$pids</code> <code class="plain">= </code><code class="keyword">array</code><code class="plain">();</code></span></span></div><div class="line alt1"><code class="number">03.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">04.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// add a counter variable</code></span></span></div><div class="line alt1"><code class="number">05.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="variable">$i</code> <code class="plain">= 0;</code></span></span></div><div class="line alt2"><code class="number">06.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">07.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">foreach</code><code class="plain">(</code><code class="variable">$contentArr</code> <code class="keyword">as</code> <code class="variable">$key</code> <code class="plain">=&gt; </code><code class="variable">$val</code><code class="plain">) {</code></span></span></div><div class="line alt2"><code class="number">08.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="comments">// load the return for pcntl_fork() into the $pids Array</code></span></span></div><div class="line alt1"><code class="number">09.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="comments">// pcntl returns -1 for a failure, 0 for the actual child process, and the actual PID for the parent to keep track of</code></span></span></div><div class="line alt2"><code class="number">10.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="variable">$pids</code><code class="plain">[</code><code class="variable">$i</code><code class="plain">] = pcntl_fork();</code></span></span></div><div class="line alt1"><code class="number">11.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">12.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="comments">// if pcntl_fork() returned 0, meaning this is the actual child process</code></span></span></div><div class="line alt1"><code class="number">13.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="keyword">if</code> <code class="plain">(!</code><code class="variable">$pids</code><code class="plain">[</code><code class="variable">$i</code><code class="plain">]) {</code></span></span></div><div class="line alt2"><code class="number">14.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 56px !important;"><code class="comments">// call the actual function</code></span></span></div><div class="line alt1"><code class="number">15.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 56px !important;"><code class="plain">call_user_func(</code><code class="variable">$val</code><code class="plain">);</code></span></span></div><div class="line alt2"><code class="number">16.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 56px !important;"><code class="comments">// call exit() after process is completed to ensure process dies</code></span></span></div><div class="line alt1"><code class="number">17.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 56px !important;"><code class="functions">exit</code><code class="plain">();</code></span></span></div><div class="line alt2"><code class="number">18.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">}</code></span></span></div><div class="line alt1"><code class="number">19.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">20.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="comments">// increment the counter</code></span></span></div><div class="line alt1"><code class="number">21.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="variable">$i</code><code class="plain">++;</code></span></span></div><div class="line alt2"><code class="number">22.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div></div></div>
<p>Now we are forking!  There’s still one small problem though.  As we are running via the command line, max_execution_time is still set to 0 (unlimited) which means that if a process does hang, it will hang forever and consume those valuable resources.  Luckily for us, pcntl in PHP provides a simple way to setup a timeout for individual threads.</p>
<h2>pcntl_alarm()</h2>
<blockquote><p>
int pcntl_alarm ( int $seconds )
</p></blockquote>
<p>Simple, we just define how long we want to give each script to finish.  We could even give each function it’s own unique timeout if we knew ahead of time that one function was going to need a longer then default time.  For our purposes, 60 seconds is pretty safe.  Here’s the code including the 60 second timeout:</p>
<div class="syntaxhighlighter " id="highlighter_650680" style=""><div class="bar"><div class="toolbar"><a href="http:///#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http:///#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http:///#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">01.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// create a new array to contain each processes PID</code></span></span></div><div class="line alt2"><code class="number">02.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="variable">$pids</code> <code class="plain">= </code><code class="keyword">array</code><code class="plain">();</code></span></span></div><div class="line alt1"><code class="number">03.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">04.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// add a counter variable</code></span></span></div><div class="line alt1"><code class="number">05.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="variable">$i</code> <code class="plain">= 0;</code></span></span></div><div class="line alt2"><code class="number">06.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">07.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// add a function to kill the process if the child timeout is reached</code></span></span></div><div class="line alt2"><code class="number">08.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">function</code> <code class="plain">signal_handler(</code><code class="variable">$signal</code><code class="plain">) {</code></span></span></div><div class="line alt1"><code class="number">09.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">print </code><code class="string">"Caught SIGALRM\n"</code><code class="plain">;</code></span></span></div><div class="line alt2"><code class="number">10.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="functions">exit</code><code class="plain">();</code></span></span></div><div class="line alt1"><code class="number">11.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">12.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">13.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">foreach</code><code class="plain">(</code><code class="variable">$contentArr</code> <code class="keyword">as</code> <code class="variable">$key</code> <code class="plain">=&gt; </code><code class="variable">$val</code><code class="plain">) {</code></span></span></div><div class="line alt2"><code class="number">14.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="comments">// load the return for pcntl_fork() into the $pids Array</code></span></span></div><div class="line alt1"><code class="number">15.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="comments">// pcntl returns -1 for a failure, 0 for the actual child process, and the actual PID for the parent to keep track of</code></span></span></div><div class="line alt2"><code class="number">16.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="variable">$pids</code><code class="plain">[</code><code class="variable">$i</code><code class="plain">] = pcntl_fork();</code></span></span></div><div class="line alt1"><code class="number">17.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">18.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="comments">// if pcntl_fork() returned 0, meaning this is the actual child process</code></span></span></div><div class="line alt1"><code class="number">19.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="keyword">if</code> <code class="plain">(!</code><code class="variable">$pids</code><code class="plain">[</code><code class="variable">$i</code><code class="plain">]) {</code></span></span></div><div class="line alt2"><code class="number">20.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 56px !important;"><code class="comments">// add a 60 second timeout for each process, calls signal_handler() if it's set off</code></span></span></div><div class="line alt1"><code class="number">21.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 56px !important;"><code class="plain">pcntl_signal(SIGALRM, </code><code class="string">"signal_handler"</code><code class="plain">, true);</code></span></span></div><div class="line alt2"><code class="number">22.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 56px !important;"><code class="plain">pcntl_alarm(60);</code></span></span></div><div class="line alt1"><code class="number">23.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 56px !important;"><code class="comments">// call the actual function</code></span></span></div><div class="line alt2"><code class="number">24.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 56px !important;"><code class="plain">call_user_func(</code><code class="variable">$val</code><code class="plain">);</code></span></span></div><div class="line alt1"><code class="number">25.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 56px !important;"><code class="comments">// call exit() after process is completed to ensure process dies</code></span></span></div><div class="line alt2"><code class="number">26.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 56px !important;"><code class="functions">exit</code><code class="plain">();</code></span></span></div><div class="line alt1"><code class="number">27.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">}</code></span></span></div><div class="line alt2"><code class="number">28.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">29.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="comments">// increment the counter</code></span></span></div><div class="line alt2"><code class="number">30.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="variable">$i</code><code class="plain">++;</code></span></span></div><div class="line alt1"><code class="number">31.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">}</code></span></span></div></div></div>
<p>Now we have solved all of our problems.  We’ve removed a global timeout so that this will scale indefinitely and we’ve added a child timeout to keep each process from hanging and using up resources.  In addition we have kept any one fatal error in a function from halting all other processes.</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
									<span class="cat-links">
						<span class="entry-utility-prep entry-utility-prep-cat-links">Posted in</span> <a href="http:///category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>					</span>
					<span class="meta-sep">|</span>
												<span class="comments-link"><a href="http:///2010/08/31/safe-process-forking-in-php/#respond" title="Comment on Safe process forking in PHP">Leave a comment</a></span>
				<span class="meta-sep">|</span> <span class="edit-link"><a class="post-edit-link" href="http:///wp-admin/post.php?post=64&action=edit" title="Edit Post">Edit</a></span>			</div><!-- .entry-utility -->
		</div><!-- #post-## -->

		
	


			
    <div class="entry-meta">
							<h3 class="wrap"><span class="day">30th                            </span>
                            </h3><span class="month">Aug                            <span class="year">2010</span></span>
					<h4 class="author"><a href="http:///author/andrew/" title="Posts by andrew">andrew</a></h4>
					<h4 class="comments"><a href="http:///2010/08/30/a-lightweight-method-to-check-sencha-touch-browser-compatibility-in-php/#comments">0</a></h4>
			</div><!-- .entry-meta -->
            
		<div id="post-47" class="post-47 post type-post hentry category-uncategorized">
			<h2 class="entry-title"><a href="http:///2010/08/30/a-lightweight-method-to-check-sencha-touch-browser-compatibility-in-php/" title="Permalink to A lightweight method to check Sencha Touch browser compatibility in PHP" rel="bookmark">A lightweight method to check Sencha Touch browser compatibility in PHP</a></h2>



				<div class="entry-content">
				<p>Nowvu uses the <a href="http://www.sencha.com/products/touch/">Sencha Touch</a> framework for the development of our interactive content request system.  Sencha Touch is Webkit based and as such requires a Webkit browser.  This means it works great on the iPhone and Android along with Safari and Chrome on the desktop.</p>
<h2>A preview of our Request UI built with Sencha:</h2>
<p><a href="reqInterface.png"><img src="reqInterface.png" alt="" title="reqInterface" width="436" height="671" class="alignnone size-full wp-image-57"></a></p>
<p><a href="http://www.sencha.com/products/touch/"><img src="SenchaPresentsSenchaTouch-300x194.jpg" alt="" title="SenchaPresentsSenchaTouch" width="300" height="194" class="alignnone size-medium wp-image-48"></a></p>
<p>Using a Sencha built application on the iPhone or Android is a dream, it feels completely native.  The experience in Safari and Chrome is only lacking some copy/paste features and obviously multitouch, it works surprisingly well.  Open something up in Firefox or IE and it’s a complete disaster, with this we needed a method to prevent this from happening.</p>
<p>In PHP:</p>
<div class="syntaxhighlighter " id="highlighter_743051" style=""><div class="bar"><div class="toolbar"><a href="http:///#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http:///#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http:///#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">1.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">if</code> <code class="plain">(</code><code class="functions">stripos</code><code class="plain">(</code><code class="variable">$_SERVER</code><code class="plain">[</code><code class="string">'HTTP_USER_AGENT'</code><code class="plain">],</code><code class="string">'webkit'</code><code class="plain">)) {</code></span></span></div><div class="line alt2"><code class="number">2.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">3.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// int stripos ( string $haystack , string $needle [, int $offset = 0 ] )</code></span></span></div><div class="line alt2"><code class="number">4.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// Returns the numeric position of the first occurrence of needle in the haystack string</code></span></span></div><div class="line alt1"><code class="number">5.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="comments">// If needle is not found, stripos() will return boolean FALSE</code></span></span></div></div></div>
<h2>You forgot about get_browser()!</h2>
<div class="syntaxhighlighter " id="highlighter_148351" style=""><div class="bar"><div class="toolbar"><a href="http:///#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http:///#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http:///#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">01.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">get_browser();</code></span></span></div><div class="line alt2"><code class="number">02.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt1"><code class="number">03.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">Array</code></span></span></div><div class="line alt2"><code class="number">04.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">(</code></span></span></div><div class="line alt1"><code class="number">05.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[browser_name_regex] =&gt; ^mozilla/5\.0 (windows; .; windows nt 5\.1; .*rv:.*) gecko/.* firefox/0\.9.*$</code></span></span></div><div class="line alt2"><code class="number">06.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[browser_name_pattern] =&gt; Mozilla/5.0 (Windows; ?; Windows NT 5.1; *rv:*) Gecko/* Firefox/0.9*</code></span></span></div><div class="line alt1"><code class="number">07.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[parent] =&gt; Firefox 0.9</code></span></span></div><div class="line alt2"><code class="number">08.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[platform] =&gt; WinXP</code></span></span></div><div class="line alt1"><code class="number">09.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[browser] =&gt; Firefox</code></span></span></div><div class="line alt2"><code class="number">10.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[version] =&gt; 0.9</code></span></span></div><div class="line alt1"><code class="number">11.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[majorver] =&gt; 0</code></span></span></div><div class="line alt2"><code class="number">12.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[minorver] =&gt; 9</code></span></span></div><div class="line alt1"><code class="number">13.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[cssversion] =&gt; 2</code></span></span></div><div class="line alt2"><code class="number">14.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[frames] =&gt; 1</code></span></span></div><div class="line alt1"><code class="number">15.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[iframes] =&gt; 1</code></span></span></div><div class="line alt2"><code class="number">16.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[tables] =&gt; 1</code></span></span></div><div class="line alt1"><code class="number">17.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[cookies] =&gt; 1</code></span></span></div><div class="line alt2"><code class="number">18.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[backgroundsounds] =&gt;</code></span></span></div><div class="line alt1"><code class="number">19.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[vbscript] =&gt;</code></span></span></div><div class="line alt2"><code class="number">20.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[javascript] =&gt; 1</code></span></span></div><div class="line alt1"><code class="number">21.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[javaapplets] =&gt; 1</code></span></span></div><div class="line alt2"><code class="number">22.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[activexcontrols] =&gt;</code></span></span></div><div class="line alt1"><code class="number">23.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[cdf] =&gt;</code></span></span></div><div class="line alt2"><code class="number">24.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[aol] =&gt;</code></span></span></div><div class="line alt1"><code class="number">25.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[beta] =&gt; 1</code></span></span></div><div class="line alt2"><code class="number">26.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[win16] =&gt;</code></span></span></div><div class="line alt1"><code class="number">27.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[crawler] =&gt;</code></span></span></div><div class="line alt2"><code class="number">28.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[stripper] =&gt;</code></span></span></div><div class="line alt1"><code class="number">29.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[wap] =&gt;</code></span></span></div><div class="line alt2"><code class="number">30.</code><span class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><span class="block" style="margin-left: 28px !important;"><code class="plain">[netclr] =&gt;</code></span></span></div><div class="line alt1"><code class="number">31.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">)</code></span></span></div></div></div>
<p>The problem with get_browser is having to load a browscap.ini file.  From php.net:</p>
<blockquote>
<p>In order for this to work, your browscap configuration setting in php.ini must point to the correct location of the browscap.ini file on your system.</p>
<p>browscap.ini is not bundled with PHP, but you may find an up-to-date » php_browscap.ini file here.</p>
<p>While browscap.ini contains information on many browsers, it relies on user updates to keep the database current. The format of the file is fairly self-explanatory
</p></blockquote>
<p>This file isn’t small, having to load it for every request could be a major burden.  It’s simple to avoid by using stripos() (case-insensitive).</p>
<h2>But that’s why Regex’s were created!</h2>
<p>It’s also worth noting, as we are looking for speed here that we could also use a regex.  We chose not to as regex’s are slow!  Read <a href="http://lzone.de/articles/php-string-search.htm">http://lzone.de/articles/php-string-search.htm</a> for some great benchmarks.</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
									<span class="cat-links">
						<span class="entry-utility-prep entry-utility-prep-cat-links">Posted in</span> <a href="http:///category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>					</span>
					<span class="meta-sep">|</span>
												<span class="comments-link"><a href="http:///2010/08/30/a-lightweight-method-to-check-sencha-touch-browser-compatibility-in-php/#respond" title="Comment on A lightweight method to check Sencha Touch browser compatibility in PHP">Leave a comment</a></span>
				<span class="meta-sep">|</span> <span class="edit-link"><a class="post-edit-link" href="http:///wp-admin/post.php?post=47&action=edit" title="Edit Post">Edit</a></span>			</div><!-- .entry-utility -->
		</div><!-- #post-## -->

		
	


			
    <div class="entry-meta">
							<h3 class="wrap"><span class="day">19th                            </span>
                            </h3><span class="month">Aug                            <span class="year">2010</span></span>
					<h4 class="author"><a href="http:///author/andrew/" title="Posts by andrew">andrew</a></h4>
					<h4 class="comments"><a href="http:///2010/08/19/cassandra-and-php-become-friendly-with-phpcassa/#comments">0</a></h4>
			</div><!-- .entry-meta -->
            
		<div id="post-30" class="post-30 post type-post hentry category-uncategorized">
			<h2 class="entry-title"><a href="http:///2010/08/19/cassandra-and-php-become-friendly-with-phpcassa/" title="Permalink to Cassandra and PHP become friendly with phpcassa" rel="bookmark">Cassandra and PHP become friendly with phpcassa</a></h2>



				<div class="entry-content">
				<p>Nowvu exclusively uses Cassandra for backend operations.  With the recent surge in interest due in no small part to companies like Digg, Reddit, Facebook and Twitter testing or using Cassandra it’s enough to get anyone’s attention.</p>
<p>From the Cassandra <a href="http://wiki.apache.org/cassandra/FrontPage">Wiki</a>:</p>
<p>Cassandra is a highly scalable, eventually consistent, distributed, structured key-value store. Cassandra brings together the distributed systems technologies from Dynamo and the data model from Google’s BigTable. Like Dynamo, Cassandra is eventually consistent. Like BigTable, Cassandra provides a ColumnFamily-based data model richer than typical key/value systems.</p>
<p>Don’t let the term “eventually consistent” data scare you.  A quorum implementation assures that you will get the latest data regardless of if it exists on every node or not.</p>
<p>Three things in particular drove me from a sharded (my)SQL solution to Cassandra:</p>
<p><b>1. Simplicity of increasing capacity</b></p>
<p>Increasing capacity to handle virtually unlimited loads can be done with MySQL, it is being done today and that is proof enough.  The problem is that it’s not that easy. Typically it is handled by sharding and doing so reduces the relationship between your data tremendously.  With SQL being “relational” this is far less then ideal.</p>
<p>With Cassandra, you can literally add capacity by adding a new node in a matter of minutes.  Add the new node to your round-robin DNS records and you are expanded!</p>
<p><b>2. A fixed schema</b></p>
<p>When working with SQL, you define a table schema.  If your project is becoming mature and you wish to add data fields, you must modify your schema and in turn your application.  This leads to having to keep track of schema’s for different versions of your software and generally a giant headache.</p>
<p>Cassandra is schema-less.  If you want a new field you just add it, it won’t affect anything else.  This decreases development time, especially as your project becomes more complicated.</p>
<p><b>3. Capacity</b></p>
<p>SQL is great if you are wanting to extract and present data to yourself in interesting ways on the fly.  Joins, subquery’s and the like are processed each time you request data.  This is far less then ideal if you are requesting the same data over and over again.  This is amplified as you begin to have thousands of users requesting the same data over and over again.</p>
<p>Cassandra flips this model around, you design your data and plan ahead for the queries you will be having.  You structure data in a way that removes the processing power required to model the data as you want.  This is called Denormalization of data, Benjamin Black explains it best in <a href="http://www.slideshare.net/benjaminblack/cassandra-basics-indexing">this slideshow</a>.</p>
<p>When it comes time to implement Cassandra in your latest project, if your language of choice is PHP I highly recommend <a href="http://github.com/hoan/phpcassa">phpcassa</a>.</p>
<p>Cassandra uses the <a href="http://incubator.apache.org/thrift/">Thrift</a> framework for implementing a communication method for most programming languages.</p>
<p>You can access Thrift directly in PHP and build your application, however it is a somewhat low level API and leaves you to do quite a bit of work yourself for trivial tasks.  Phpcassa provides you with a clean, object based high level method of accessing Cassandra on top of Thrift.</p>
<h2>Installing Cassandra</h2>
<p>Cassandra is written in Java, installing it on Ubuntu 10.04 required the following:</p>
<div class="syntaxhighlighter " id="highlighter_375030" style=""><div class="bar"><div class="toolbar"><a href="http:///#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http:///#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http:///#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">1.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">apt-get install openjdk-6-jdk</code></span></span></div><div class="line alt2"><code class="number">2.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">wget http:</code><code class="comments">//www.apache.org/dyn/closer.cgi?path=/cassandra/0.6.4/apache-cassandra-0.6.4-bin.tar.gz</code></span></span></div><div class="line alt1"><code class="number">3.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">tar -xzvf apache-cassandra-0.6.4-bin.tar.gz</code></span></span></div><div class="line alt2"><code class="number">4.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">cd apache-cassandra-0.6.4</code></span></span></div><div class="line alt1"><code class="number">5.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">./bin/cassandra</code></span></span></div></div></div>
<h2>Installing phpcassa</h2>
<p>Assuming you have a working PHP+Apache installation going, installing phpcassa is quite simple.  Thrift is already included!</p>
<p>Download the source from <a href="http://github.com/hoan/phpcassa">http://github.com/hoan/phpcassa</a> and unzip/targz the file.  Rename the root directory of phpcassa to include, move include to your webroot foloder, and add the following lines to the top of your php script:</p>
<div class="syntaxhighlighter " id="highlighter_584643" style=""><div class="bar"><div class="toolbar"><a href="http:///#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http:///#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http:///#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">01.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="variable">$GLOBALS</code><code class="plain">[</code><code class="string">'THRIFT_ROOT'</code><code class="plain">] = dirname(</code><code class="constants">__FILE__</code><code class="plain">) . </code><code class="string">'/include/thrift/'</code><code class="plain">;</code></span></span></div><div class="line alt2"><code class="number">02.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">require_once</code> <code class="variable">$GLOBALS</code><code class="plain">[</code><code class="string">'THRIFT_ROOT'</code><code class="plain">].</code><code class="string">'/packages/cassandra/Cassandra.php'</code><code class="plain">;</code></span></span></div><div class="line alt1"><code class="number">03.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">require_once</code> <code class="variable">$GLOBALS</code><code class="plain">[</code><code class="string">'THRIFT_ROOT'</code><code class="plain">].</code><code class="string">'/transport/TSocket.php'</code><code class="plain">;</code></span></span></div><div class="line alt2"><code class="number">04.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">require_once</code> <code class="variable">$GLOBALS</code><code class="plain">[</code><code class="string">'THRIFT_ROOT'</code><code class="plain">].</code><code class="string">'/protocol/TBinaryProtocol.php'</code><code class="plain">;</code></span></span></div><div class="line alt1"><code class="number">05.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">require_once</code> <code class="variable">$GLOBALS</code><code class="plain">[</code><code class="string">'THRIFT_ROOT'</code><code class="plain">].</code><code class="string">'/transport/TFramedTransport.php'</code><code class="plain">;</code></span></span></div><div class="line alt2"><code class="number">06.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">require_once</code> <code class="variable">$GLOBALS</code><code class="plain">[</code><code class="string">'THRIFT_ROOT'</code><code class="plain">].</code><code class="string">'/transport/TBufferedTransport.php'</code><code class="plain">;</code></span></span></div><div class="line alt1"><code class="number">07.</code><span class="content"><span class="block" style="margin-left: 0px !important;">&nbsp;</span></span></div><div class="line alt2"><code class="number">08.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">include_once</code><code class="plain">(dirname(</code><code class="constants">__FILE__</code><code class="plain">) . </code><code class="string">'/include/phpcassa.php'</code><code class="plain">);</code></span></span></div><div class="line alt1"><code class="number">09.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="keyword">include_once</code><code class="plain">(dirname(</code><code class="constants">__FILE__</code><code class="plain">) . </code><code class="string">'/include/uuid.php'</code><code class="plain">);</code></span></span></div></div></div>
<p>Your done, read the phpcassa README at <a href="http://github.com/hoan/phpcassa">http://github.com/hoan/phpcassa</a> and you’ll be mutating data in no time!</p>
<h2>Time to Optimize!</h2>
<p>Once you start worrying about performance, keep in mind that this method is using a non native Thrift PHP interface.  Lucky for you it’s easy to compile Thrift as a php extension (thrift_protocol.so)!  It’s already in the phpcassa source you downloaded earlier:</p>
<div class="syntaxhighlighter " id="highlighter_764612" style=""><div class="bar"><div class="toolbar"><a href="http:///#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http:///#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http:///#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">1.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">cd </code><code class="keyword">include</code><code class="plain">/thrift/ext/thrift_protocol/</code></span></span></div><div class="line alt2"><code class="number">2.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">phpize</code></span></span></div><div class="line alt1"><code class="number">3.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">./configure --enable-thrift_protocol</code></span></span></div><div class="line alt2"><code class="number">4.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">make</code></span></span></div><div class="line alt1"><code class="number">5.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">make install</code></span></span></div></div></div>
<p>On Ubuntu you’ll need to have the build tools:</p>
<div class="syntaxhighlighter " id="highlighter_648942" style=""><div class="bar"><div class="toolbar"><a href="http:///#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http:///#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http:///#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">1.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">apt-get install libboost-dev automake libtool flex bison pkg-config g++ php5-cli php5-dev</code></span></span></div></div></div>
<h2>Other Reading</h2>
<p>If you are coming from a relational database background, it’s going to take some reading, thinking, and testing to get used to Cassandra.  Once you do you’ll be happy you did!</p>
<p>Absolutely, if you haven’t already you must read: <a href="http://arin.me/blog/wtf-is-a-supercolumn-cassandra-data-model">WTF is a SuperColumn? An Intro to the Cassandra Data Model</a> from Arin Sarkissian over at <a href="http://www.digg.com/">Digg</a>.</p>
<p>Take some time and read these other articles:</p>
<p><a href="http://www.divconq.com/2010/how-to-add-and-retrieve-data-from-a-cassandra-database/">How to Add and Retrieve Data from a Cassandra Database</a></p>
<p><a href="http://about.digg.com/blog/looking-future-cassandra">Looking to the future with Cassandra</a></p>
<p><a href="http://www.slideshare.net/benjaminblack/cassandra-basics-indexing">http://www.slideshare.net/benjaminblack/cassandra-basics-indexing</a></p>
<p><a href="http://maxgrinev.com/2010/07/12/do-you-really-need-sql-to-do-it-all-in-cassandra/">Do You Really Need SQL to Do It All in Cassandra?</a></p>
<p><a href="http://www.rackspacecloud.com/blog/2010/05/12/cassandra-by-example/">Cassandra By Example</a> (python people)</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
									<span class="cat-links">
						<span class="entry-utility-prep entry-utility-prep-cat-links">Posted in</span> <a href="http:///category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>					</span>
					<span class="meta-sep">|</span>
												<span class="comments-link"><a href="http:///2010/08/19/cassandra-and-php-become-friendly-with-phpcassa/#respond" title="Comment on Cassandra and PHP become friendly with phpcassa">Leave a comment</a></span>
				<span class="meta-sep">|</span> <span class="edit-link"><a class="post-edit-link" href="http:///wp-admin/post.php?post=30&action=edit" title="Edit Post">Edit</a></span>			</div><!-- .entry-utility -->
		</div><!-- #post-## -->

		
	


			
    <div class="entry-meta">
							<h3 class="wrap"><span class="day">17th                            </span>
                            </h3><span class="month">Aug                            <span class="year">2010</span></span>
					<h4 class="author"><a href="http:///author/andrew/" title="Posts by andrew">andrew</a></h4>
					<h4 class="comments"><a href="http:///2010/08/17/using-apache-mod_rewrite-to-simplify-urls/#comments">0</a></h4>
			</div><!-- .entry-meta -->
            
		<div id="post-27" class="post-27 post type-post hentry category-uncategorized">
			<h2 class="entry-title"><a href="http:///2010/08/17/using-apache-mod_rewrite-to-simplify-urls/" title="Permalink to Using Apache mod_rewrite to simplify URLs" rel="bookmark">Using Apache mod_rewrite to simplify URLs</a></h2>



				<div class="entry-content">
				<p>Nowvu allows interaction with our displays in multiple ways. &nbsp;One method is by allowing patrons of any particular venue to request the content they want to see with their mobile device.</p>
<p>Our screen displays a URL like http://nowvu.com/scr1 which they can visit and make these requests.</p>
<p>It’s important that this url be as short as possible, users are typing on iPhones and Droids and do not want to type out 140 characters just to request what content to see next. &nbsp;Because of this we use mod_rewrite in the following fashion:</p>
<p>.htaccess – file in root web directory</p>
<div class="syntaxhighlighter " id="highlighter_767279" style=""><div class="bar"><div class="toolbar"><a href="http:///#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http:///#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http:///#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">1.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">&lt;IfModule mod_rewrite.c&gt;</code></span></span></div><div class="line alt2"><code class="number">2.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">RewriteEngine On</code></span></span></div><div class="line alt1"><code class="number">3.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">RewriteCond %{REQUEST_FILENAME} !-f</code></span></span></div><div class="line alt2"><code class="number">4.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">RewriteCond %{REQUEST_FILENAME} !-d</code></span></span></div><div class="line alt1"><code class="number">5.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">RewriteRule ^(.*)$ vote.php?venueId=</code><code class="variable">$1</code> <code class="plain">[L]</code></span></span></div><div class="line alt2"><code class="number">6.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">&lt;/IfModule&gt;</code></span></span></div></div></div>
<p>Confirm that mod_rewrite exists:</p>
<div class="syntaxhighlighter " id="highlighter_694281" style=""><div class="bar"><div class="toolbar"><a href="http:///#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http:///#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http:///#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">1.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">&lt;IfModule mod_rewrite.c&gt;</code></span></span></div><div class="line alt2"><code class="number">2.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">&lt;/IfModule&gt;</code></span></span></div></div></div>
<p>Conditions to check if file (-f) and directory (-d) do not exist</p>
<div class="syntaxhighlighter " id="highlighter_223344" style=""><div class="bar"><div class="toolbar"><a href="http:///#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http:///#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http:///#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">1.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">RewriteCond %{REQUEST_FILENAME} !-f</code></span></span></div><div class="line alt2"><code class="number">2.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">RewriteCond %{REQUEST_FILENAME} !-d</code></span></span></div></div></div>
<p>RewriteRule &nbsp;to redirect matches of the above conditions to vote.php?venueId=$1 ($1 is the original request)</p>
<div class="syntaxhighlighter " id="highlighter_850363" style=""><div class="bar"><div class="toolbar"><a href="http:///#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http:///#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http:///#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">1.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">RewriteRule ^(.*)$ vote.php?venueId=</code><code class="variable">$1</code> <code class="plain">[L]</code></span></span></div></div></div>
<p>The last step is to make sure you are allowing .htaccess files for your web directory.  We configure this in the VirtualHost directive for the site.</p>
<div class="syntaxhighlighter " id="highlighter_817072" style=""><div class="bar"><div class="toolbar"><a href="http:///#viewSource" title="view source" style="width: 16px; height: 16px;" class="item viewSource">view source</a><a href="http:///#printSource" title="print" style="width: 16px; height: 16px;" class="item printSource">print</a><a href="http:///#about" title="?" style="width: 16px; height: 16px;" class="item about">?</a></div></div><div class="lines"><div class="line alt1"><code class="number">1.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">&lt;Directory </code><code class="string">"/var/www/nowvu.com"</code><code class="plain">&gt;</code></span></span></div><div class="line alt2"><code class="number">2.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">Options Indexes Includes FollowSymLinks MultiViews</code></span></span></div><div class="line alt1"><code class="number">3.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">AllowOverride AuthConfig FileInfo</code></span></span></div><div class="line alt2"><code class="number">4.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">Order allow,deny</code></span></span></div><div class="line alt1"><code class="number">5.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">Allow from all</code></span></span></div><div class="line alt2"><code class="number">6.</code><span class="content"><span class="block" style="margin-left: 0px !important;"><code class="plain">&lt;/Directory&gt;</code></span></span></div></div></div>
<p>Now any request to http://nowvu.com where the request name does not exist as a file or directory gets rewritten as the venueId variable for vote.php.</p>
<p>This also causes one problem, what if a file doesn’t exist but it also is not an actual venueId? &nbsp;In this case we must add some simple logic in vote.php to check our cassandra backend for the venueId and return an actual 404 if it doesn’t exist!</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
									<span class="cat-links">
						<span class="entry-utility-prep entry-utility-prep-cat-links">Posted in</span> <a href="http:///category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>					</span>
					<span class="meta-sep">|</span>
												<span class="comments-link"><a href="http:///2010/08/17/using-apache-mod_rewrite-to-simplify-urls/#respond" title="Comment on Using Apache mod_rewrite to simplify URLs">Leave a comment</a></span>
				<span class="meta-sep">|</span> <span class="edit-link"><a class="post-edit-link" href="http:///wp-admin/post.php?post=27&action=edit" title="Edit Post">Edit</a></span>			</div><!-- .entry-utility -->
		</div><!-- #post-## -->

		
	

			</div><!-- #content -->
		</div><!-- #container -->


		<div id="primary" class="widget-area" role="complementary">
			<ul class="xoxo">

<li id="nav_menu-3" class="widget-container widget_nav_menu"><div class="menu-follow-container"><ul id="menu-follow" class="menu"><li id="menu-item-46" class="menu-item menu-item-type-custom menu-item-46"><a href="http://twitter.com/nowvu">Twitter</a></li>
</ul></div></li>		<li id="recent-posts-2" class="widget-container widget_recent_entries">		<h3 class="widget-title">Recent Posts</h3>		<ul>
				<li><a href="http:///2010/08/31/app-screenshots/" title="App Screenshots">App Screenshots</a></li>
				<li><a href="http:///2010/08/31/safe-process-forking-in-php/" title="Safe process forking in PHP">Safe process forking in PHP</a></li>
				<li><a href="http:///2010/08/30/a-lightweight-method-to-check-sencha-touch-browser-compatibility-in-php/" title="A lightweight method to check Sencha Touch browser compatibility in PHP">A lightweight method to check Sencha Touch browser compatibility in PHP</a></li>
				<li><a href="http:///2010/08/19/cassandra-and-php-become-friendly-with-phpcassa/" title="Cassandra and PHP become friendly with phpcassa">Cassandra and PHP become friendly with phpcassa</a></li>
				<li><a href="http:///2010/08/17/using-apache-mod_rewrite-to-simplify-urls/" title="Using Apache mod_rewrite to simplify URLs">Using Apache mod_rewrite to simplify URLs</a></li>
				</ul>
		</li><li id="recent-comments-2" class="widget-container widget_recent_comments"><h3 class="widget-title">Recent Comments</h3><ul id="recentcomments"></ul></li><li id="archives-2" class="widget-container widget_archive"><h3 class="widget-title">Archives</h3>		<ul>
			<li><a href="http:///2010/08/" title="August 2010">August 2010</a></li>
		</ul>
</li><li id="categories-2" class="widget-container widget_categories"><h3 class="widget-title">Categories</h3>		<ul>
	<li class="cat-item cat-item-1"><a href="http:///category/uncategorized/" title="View all posts filed under Uncategorized">Uncategorized</a>
</li>
		</ul>
</li><li id="meta-2" class="widget-container widget_meta"><h3 class="widget-title">Meta</h3>			<ul>
			<li><a href="http:///wp-admin/">Site Admin</a></li>			<li><a href="http:///wp-login.php?action=logout&_wpnonce=0ae8ec110a">Log out</a></li>
			<li><a href="http:///feed/" title="Syndicate this site using RSS 2.0">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http:///comments/feed/" title="The latest comments to all posts in RSS">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>
						</ul>
</li>			</ul>
		</div><!-- #primary .widget-area -->

	</div><!-- #main -->

	<div id="footer" role="contentinfo">
		<div id="colophon">



			<div id="site-info">
				<a href="blog.html" title="Welcome to the Nowvu Blog." rel="home">
					Welcome to the Nowvu Blog.				</a>
			</div><!-- #site-info -->

			<div id="site-generator">
								<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">
					Proudly powered by WordPress.				</a>
			</div><!-- #site-generator -->

		</div><!-- #colophon -->
	</div><!-- #footer -->

</div><!-- #wrapper -->


<!-- SyntaxHighlighter Stuff -->
<script type="text/javascript" src="shCore.js"></script>
	<script type="text/javascript" src="shBrushPhp.js"></script>
	<!-- Reassign aliases -->
	<script type="text/javascript">
				SyntaxHighlighter.brushes.Php.aliases = ["php"];
	</script>
<script type="text/javascript">
	SyntaxHighlighter.all();
</script>



</div></body></html>
